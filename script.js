(()=>{"use strict";var e;e||(e={});const t={};var n;n||(n={});const o={};var i,s;!function(e){e[e.EXAMPLE_RESEARCH_1=1]="EXAMPLE_RESEARCH_1",e[e.EXAMPLE_RESEARCH_2=2]="EXAMPLE_RESEARCH_2",e[e.EXAMPLE_RESEARCH_3=3]="EXAMPLE_RESEARCH_3"}(i||(i={})),function(e){e.RESEARCH_1="Research I",e.RESEARCH_2="Research II",e.RESEARCH_3="Research III",e.RESEARCH_4="Research IV",e.RESEARCH_5="Research V"}(s||(s={}));const c={[i.EXAMPLE_RESEARCH_1]:{name:"Example Research 1",level:s.RESEARCH_1},[i.EXAMPLE_RESEARCH_2]:{name:"Example Research 2",level:s.RESEARCH_2,dependencies:[i.EXAMPLE_RESEARCH_1]},[i.EXAMPLE_RESEARCH_3]:{name:"Example Research 3",level:s.RESEARCH_3,dependencies:[i.EXAMPLE_RESEARCH_2]}};class a{constructor({name:e,level:t,dependencies:n=[],buildings:o=[],recipes:i=[],locked:s=!0}){this.dependants=[],this.name=e,this.level=t,this.dependencies=n,this.buildings=o,this.recipes=i,this.locked=s}unlock(){this.locked&&(this.dependencies.forEach((e=>{l[e].unlock()})),this.locked=!1,this.buildings.forEach((e=>{t[e].locked=!1})),this.recipes.forEach((e=>{o[e].locked=!1})))}lock(){this.locked||(this.dependants.forEach((e=>{l[e].lock()})),this.locked=!0,this.buildings.forEach((e=>{t[e].locked=!0})),this.recipes.forEach((e=>{o[e].locked=!0})))}}const r=new Map,l=Object.fromEntries(Object.values(i).filter((e=>"number"==typeof e)).map((e=>{var t;return null===(t=c[e].dependencies)||void 0===t||t.forEach((t=>{r.set(e,t)})),[e,new a(c[e])]})));var d;r.forEach(((e,t)=>{l[e].dependants.push(t)})),function(e){e.DEFAULT="default",e.SUCCESS="success",e.WARNING="warning",e.ERROR="error"}(d||(d={}));class E{constructor(e,t,n=d.DEFAULT,o=0,i=!0){this.heading=e,this.message=t,this.style=n,this.notification=this.createNotification(),this.button_container=this.createButtonContainer(),i&&this.createCloseButton(),E.container.appendChild(this.notification),o>0&&(this.timeout=window.setTimeout(this.closeNotification.bind(this),o))}createNotification(){const e=document.createElement("div");e.classList.add(this.style);const t=document.createElement("h1");t.textContent=this.heading,e.appendChild(t);const n=document.createElement("p");return n.innerHTML=this.message,e.appendChild(n),e}createButtonContainer(){const e=document.createElement("div");return e.classList.add("flex_row"),this.notification.appendChild(e),e}createCloseButton(){const e=document.createElement("div");e.textContent="Close",e.classList.add("button"),e.addEventListener("click",this.closeNotification.bind(this)),this.button_container.appendChild(e)}closeNotification(){this.notification.remove(),this.timeout&&window.clearTimeout(this.timeout)}}E.container=document.getElementById("notifs_container");class u extends E{constructor(e,t,n=d.DEFAULT,o){super(e,t,n,0,!1),this.buttons=o}setupPromptButtons(e){this.buttons.forEach((t=>{const n=document.createElement("div");n.textContent=t.label,n.classList.add("button"),n.addEventListener("click",this.closeNotification.bind(this)),n.addEventListener("click",(()=>e(t.retval))),this.button_container.appendChild(n)}))}prompt(){return new Promise((e=>{this.setupPromptButtons(e)}))}}var h=function(e,t,n,o){return new(n||(n=Promise))((function(i,s){function c(e){try{r(o.next(e))}catch(e){s(e)}}function a(e){try{r(o.throw(e))}catch(e){s(e)}}function r(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,a)}r((o=o.apply(e,t||[])).next())}))};let R=!1,p=!1,_=!1;const m=document.getElementById("set_researches_btn"),f=document.getElementById("set_recipes_btn"),A=document.getElementById("researches_window"),S=document.getElementById("researches_container"),w=document.getElementById("recipes_window"),L=new Map,v=new Map;var g;function C(e){const t=e.target,n=Number(t.dataset.toggles),o=l[n];o.locked?o.unlock():o.lock()}function b(){A.classList.toggle("hidden"),m.classList.toggle("active"),_&&O(),p=!p}function O(){w.classList.toggle("hidden"),f.classList.toggle("active"),p&&b(),_=!_}function M(e){return h(this,void 0,void 0,(function*(){let t,s;t=e?function(){const e=new URLSearchParams(window.location.search);return{research:e.get("research"),recipes:e.get("recipes"),inputs:e.get("inputs"),outputs:e.get("outputs")}}():{research:window.localStorage.getItem("research"),recipes:window.localStorage.getItem("recipes"),inputs:window.localStorage.getItem("inputs"),outputs:window.localStorage.getItem("outputs")};try{s=function(e){var t,n,o,i;try{const s=JSON.parse(null!==(t=e.research)&&void 0!==t?t:"[]"),c=JSON.parse(null!==(n=e.recipes)&&void 0!==n?n:"[]"),a=JSON.parse(null!==(o=e.inputs)&&void 0!==o?o:"[]"),r=JSON.parse(null!==(i=e.outputs)&&void 0!==i?i:"[]");return[s,c,a,r].forEach((e=>{if(!Array.isArray(e))throw new Error("One of the parameters isn't an array.");e.forEach(((e,t,n)=>{if("number"!=typeof e&&(n[t]=Number(e),isNaN(n[t])))throw new Error("One of the arrays contains something other than a number.")}))})),{research:s,recipes:c,inputs:a,outputs:r}}catch(e){throw e}}(t)}catch(t){let n="Unknown Error",o="";if(t instanceof SyntaxError?(n=g.MALFORMED_JSON_HEADER,o=e?g.MALFORMED_JSON_MESSAGE_URL+g.ERROR_FIX_MESSAGE_URL:g.MALFORMED_JSON_MESSAGE_LOCALSTORAGE+g.ERROR_FIX_MESSAGE_LOCALSTORAGE):t instanceof Error&&(n=g.INVALID_DATA_HEADER,o=t.message+(e?g.ERROR_FIX_MESSAGE_URL:g.ERROR_FIX_MESSAGE_LOCALSTORAGE)),!(yield new u(n,o,d.ERROR,[{label:"Yes",retval:!0},{label:"No",retval:!1}]).prompt()))throw new E("Successfully Aborted","Initialization was successfully aborted.",void 0,void 0,!1),"";if(e){const e=new URL(window.location.href);e.search="",history.pushState(null,"",e.toString())}else window.localStorage.clear(),window.location.reload();return!1}return function(e){e.research.forEach((e=>{e in i?l[e].unlock():new E("Unknown Research ID",`The research ID ${e} is unknown and could not be enabled.`,d.WARNING)})),e.recipes.forEach((e=>{e in n?o[e].active=!1:new E("Unknown Recipe ID",`The recipe ID ${e} is unknown and could not be disabled.`,d.WARNING)}))}(s),!0}))}!function(e){e.MALFORMED_JSON_HEADER="Malformed JSON",e.INVALID_DATA_HEADER="Invalid Data",e.MALFORMED_JSON_MESSAGE_URL="The JSON provided by the search parameters in the URL seems to be malformed.",e.MALFORMED_JSON_MESSAGE_LOCALSTORAGE="The JSON loaded from your browsers local storage seems to be malformed.",e.ERROR_FIX_MESSAGE_URL="<br><br>Do you want to continue anyways, loading your usual settings, losing the current calculation in the process?",e.ERROR_FIX_MESSAGE_LOCALSTORAGE="<br><br>Do you want clear it and try again? This means losing your selected research and recipes."}(g||(g={})),function(){h(this,void 0,void 0,(function*(){if(function(){var e;for(const e of Object.values(s)){const t=document.createElement("div"),n=document.createElement("h1"),o=document.createElement("hr"),i=document.createElement("div");t.classList.add("researches_lists_container"),n.textContent=e,i.classList.add("flex_row","flex_allow_wrap"),t.appendChild(n),t.appendChild(o),t.appendChild(i),S.appendChild(t),L.set(e,t),v.set(e,i)}for(const[t,n]of Object.entries(l)){const o=document.createElement("div");o.textContent=n.name,o.classList.add("button",n.locked?"inactive":"active"),o.dataset.toggles=t,o.addEventListener("click",C),null===(e=v.get(n.level))||void 0===e||e.appendChild(o)}}(),window.location.search)try{R=yield M(!0)}catch(e){return}if(!R)try{yield M(!1)}catch(e){return}[[m,"click",b],[f,"click",O]].forEach((([e,t,n])=>{e.addEventListener(t,n)})),m.click()}))}()})();