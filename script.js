(()=>{"use strict";var e;e||(e={});const t={};var n;n||(n={});const s={};var i,o;!function(e){e[e.EXAMPLE_RESEARCH_1=1]="EXAMPLE_RESEARCH_1",e[e.EXAMPLE_RESEARCH_2=2]="EXAMPLE_RESEARCH_2",e[e.EXAMPLE_RESEARCH_3=3]="EXAMPLE_RESEARCH_3"}(i||(i={})),function(e){e.RESEARCH_1="Research I",e.RESEARCH_2="Research II",e.RESEARCH_3="Research III",e.RESEARCH_4="Research IV",e.RESEARCH_5="Research V"}(o||(o={}));const c={[i.EXAMPLE_RESEARCH_1]:{name:"Example Research 1",level:o.RESEARCH_1},[i.EXAMPLE_RESEARCH_2]:{name:"Example Research 2",level:o.RESEARCH_2,dependencies:[i.EXAMPLE_RESEARCH_1]},[i.EXAMPLE_RESEARCH_3]:{name:"Example Research 3",level:o.RESEARCH_3,dependencies:[i.EXAMPLE_RESEARCH_2]}};class r{constructor({name:e,level:t,dependencies:n=[],buildings:s=[],recipes:i=[],locked:o=!0}){this.dependants=[],this.name=e,this.level=t,this.dependencies=n,this.buildings=s,this.recipes=i,this.locked=o,this.button=this.createResearchButton()}unlock(){this.locked&&(this.dependencies.forEach((e=>{l[e].unlock()})),this.locked=!1,this.buildings.forEach((e=>{t[e].locked=!1})),this.recipes.forEach((e=>{s[e].locked=!1})),this.button.classList.replace("inactive","active"))}lock(){this.locked||(this.dependants.forEach((e=>{l[e].lock()})),this.locked=!0,this.buildings.forEach((e=>{t[e].locked=!0})),this.recipes.forEach((e=>{s[e].locked=!0})),this.button.classList.replace("active","inactive"))}toggleResearch(){this.locked?this.unlock():this.lock()}static initResearchesWindow(){const e=document.getElementById("researches_container");for(const t of Object.values(o)){const n=document.createElement("div"),s=document.createElement("h1"),i=document.createElement("hr"),o=document.createElement("div");n.classList.add("researches_lists_container"),s.textContent=t,o.classList.add("flex_row","flex_allow_wrap"),n.appendChild(s),n.appendChild(i),n.appendChild(o),e.appendChild(n),r.researches_level_containers.set(t,n),r.researches_lists.set(t,o)}}createResearchButton(){var e;const t=document.createElement("div");return t.textContent=this.name,t.classList.add("button",this.locked?"inactive":"active"),t.addEventListener("click",this.toggleResearch.bind(this)),null===(e=r.researches_lists.get(this.level))||void 0===e||e.appendChild(t),t}}r.researches_level_containers=new Map,r.researches_lists=new Map,r.initResearchesWindow();const a=new Map,l=Object.fromEntries(Object.values(i).filter((e=>"number"==typeof e)).map((e=>{var t;return null===(t=c[e].dependencies)||void 0===t||t.forEach((t=>{a.set(e,t)})),[e,new r(c[e])]})));var d;a.forEach(((e,t)=>{l[e].dependants.push(t)})),function(e){e.DEFAULT="default",e.SUCCESS="success",e.WARNING="warning",e.ERROR="error"}(d||(d={}));class h{constructor(e,t,n=d.DEFAULT,s=0,i=!0){this.heading=e,this.message=t,this.style=n,this.notification=this.createNotification(),this.button_container=this.createButtonContainer(),i&&this.createCloseButton(),h.container.appendChild(this.notification),s>0&&(this.timeout=window.setTimeout(this.closeNotification.bind(this),s))}createNotification(){const e=document.createElement("div");e.classList.add(this.style);const t=document.createElement("h1");t.textContent=this.heading,e.appendChild(t);const n=document.createElement("p");return n.innerHTML=this.message,e.appendChild(n),e}createButtonContainer(){const e=document.createElement("div");return e.classList.add("flex_row"),this.notification.appendChild(e),e}createCloseButton(){const e=document.createElement("div");e.textContent="Close",e.classList.add("button"),e.addEventListener("click",this.closeNotification.bind(this)),this.button_container.appendChild(e)}closeNotification(){this.notification.remove(),this.timeout&&window.clearTimeout(this.timeout)}}h.container=document.getElementById("notifs_container");class E extends h{constructor(e,t,n=d.DEFAULT,s){super(e,t,n,0,!1),this.buttons=s}setupPromptButtons(e){this.buttons.forEach((t=>{const n=document.createElement("div");n.textContent=t.label,n.classList.add("button"),n.addEventListener("click",this.closeNotification.bind(this)),n.addEventListener("click",(()=>e(t.retval))),this.button_container.appendChild(n)}))}prompt(){return new Promise((e=>{this.setupPromptButtons(e)}))}}var u=function(e,t,n,s){return new(n||(n=Promise))((function(i,o){function c(e){try{a(s.next(e))}catch(e){o(e)}}function r(e){try{a(s.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,r)}a((s=s.apply(e,t||[])).next())}))};let R=!1,p=!1,_=!1;const m=document.getElementById("set_researches_btn"),A=document.getElementById("set_recipes_btn"),f=document.getElementById("researches_window"),S=document.getElementById("recipes_window");var w;function v(){f.classList.toggle("hidden"),m.classList.toggle("active"),_&&L(),p=!p}function L(){S.classList.toggle("hidden"),A.classList.toggle("active"),p&&v(),_=!_}function g(e){return u(this,void 0,void 0,(function*(){let t,o;t=e?function(){const e=new URLSearchParams(window.location.search);return{research:e.get("research"),recipes:e.get("recipes"),inputs:e.get("inputs"),outputs:e.get("outputs")}}():{research:window.localStorage.getItem("research"),recipes:window.localStorage.getItem("recipes"),inputs:window.localStorage.getItem("inputs"),outputs:window.localStorage.getItem("outputs")};try{o=function(e){var t,n,s,i;try{const o=JSON.parse(null!==(t=e.research)&&void 0!==t?t:"[]"),c=JSON.parse(null!==(n=e.recipes)&&void 0!==n?n:"[]"),r=JSON.parse(null!==(s=e.inputs)&&void 0!==s?s:"[]"),a=JSON.parse(null!==(i=e.outputs)&&void 0!==i?i:"[]");return[o,c,r,a].forEach((e=>{if(!Array.isArray(e))throw new Error("One of the parameters isn't an array.");e.forEach(((e,t,n)=>{if("number"!=typeof e&&(n[t]=Number(e),isNaN(n[t])))throw new Error("One of the arrays contains something other than a number.")}))})),{research:o,recipes:c,inputs:r,outputs:a}}catch(e){throw e}}(t)}catch(t){let n="Unknown Error",s="";if(t instanceof SyntaxError?(n=w.MALFORMED_JSON_HEADER,s=e?w.MALFORMED_JSON_MESSAGE_URL+w.ERROR_FIX_MESSAGE_URL:w.MALFORMED_JSON_MESSAGE_LOCALSTORAGE+w.ERROR_FIX_MESSAGE_LOCALSTORAGE):t instanceof Error&&(n=w.INVALID_DATA_HEADER,s=t.message+(e?w.ERROR_FIX_MESSAGE_URL:w.ERROR_FIX_MESSAGE_LOCALSTORAGE)),!(yield new E(n,s,d.ERROR,[{label:"Yes",retval:!0},{label:"No",retval:!1}]).prompt()))throw new h("Successfully Aborted","Initialization was successfully aborted.",void 0,void 0,!1),"";if(e){const e=new URL(window.location.href);e.search="",history.pushState(null,"",e.toString())}else window.localStorage.clear(),window.location.reload();return!1}return function(e){e.research.forEach((e=>{e in i?l[e].toggleResearch():new h("Unknown Research ID",`The research ID ${e} is unknown and could not be enabled.`,d.WARNING)})),e.recipes.forEach((e=>{e in n?s[e].active=!1:new h("Unknown Recipe ID",`The recipe ID ${e} is unknown and could not be disabled.`,d.WARNING)}))}(o),!0}))}!function(e){e.MALFORMED_JSON_HEADER="Malformed JSON",e.INVALID_DATA_HEADER="Invalid Data",e.MALFORMED_JSON_MESSAGE_URL="The JSON provided by the search parameters in the URL seems to be malformed.",e.MALFORMED_JSON_MESSAGE_LOCALSTORAGE="The JSON loaded from your browsers local storage seems to be malformed.",e.ERROR_FIX_MESSAGE_URL="<br><br>Do you want to continue anyways, loading your usual settings, losing the current calculation in the process?",e.ERROR_FIX_MESSAGE_LOCALSTORAGE="<br><br>Do you want clear it and try again? This means losing your selected research and recipes."}(w||(w={})),function(){u(this,void 0,void 0,(function*(){if(window.location.search)try{R=yield g(!0)}catch(e){return}if(!R)try{yield g(!1)}catch(e){return}[[m,"click",v],[A,"click",L]].forEach((([e,t,n])=>{e.addEventListener(t,n)})),m.click()}))}()})();