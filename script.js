(()=>{"use strict";var e;e||(e={});const t={};var n;!function(e){e[e.EXAMPLE_BUILDING_1=1]="EXAMPLE_BUILDING_1",e[e.EXAMPLE_BUILDING_2=2]="EXAMPLE_BUILDING_2",e[e.EXAMPLE_BUILDING_3=3]="EXAMPLE_BUILDING_3"}(n||(n={}));const i={[n.EXAMPLE_BUILDING_1]:{name:"Example Building 1",build_cost:[]},[n.EXAMPLE_BUILDING_2]:{name:"Example Building 2",build_cost:[]},[n.EXAMPLE_BUILDING_3]:{name:"Example Building 3",build_cost:[]}};class s{constructor({name:e,build_cost:t,workers:n=0,electricity:i=0,computing:s=0,maintenance_1:o=0,maintenance_2:c=0,maintenance_3:a=0,locked:r=!0}){this.name=e,this.build_cost=t,this.workers=n,this.electricity=i,this.computing=s,this.maintenance_1=o,this.maintenance_2=c,this.maintenance_3=a,this.locked=r}}const o=Object.fromEntries(Object.values(n).filter((e=>"number"==typeof e)).map((e=>[e,new s(i[e])])));var c,a;!function(e){e[e.EXAMPLE_RESEARCH_1=1]="EXAMPLE_RESEARCH_1",e[e.EXAMPLE_RESEARCH_2=2]="EXAMPLE_RESEARCH_2",e[e.EXAMPLE_RESEARCH_3=3]="EXAMPLE_RESEARCH_3"}(c||(c={})),function(e){e.RESEARCH_1="Research I",e.RESEARCH_2="Research II",e.RESEARCH_3="Research III",e.RESEARCH_4="Research IV",e.RESEARCH_5="Research V"}(a||(a={}));const r={[c.EXAMPLE_RESEARCH_1]:{name:"Example Research 1",level:a.RESEARCH_1},[c.EXAMPLE_RESEARCH_2]:{name:"Example Research 2",level:a.RESEARCH_2,dependencies:[c.EXAMPLE_RESEARCH_1]},[c.EXAMPLE_RESEARCH_3]:{name:"Example Research 3",level:a.RESEARCH_3,dependencies:[c.EXAMPLE_RESEARCH_2]}};class l{constructor({name:e,level:t,dependencies:n=[],buildings:i=[],recipes:s=[],locked:o=!0}){this.dependants=[],this.name=e,this.level=t,this.dependencies=n,this.buildings=i,this.recipes=s,this.locked=o,this.button=this.createResearchButton()}unlock(){this.locked&&(this.dependencies.forEach((e=>{E[e].unlock()})),this.locked=!1,this.buildings.forEach((e=>{o[e].locked=!1})),this.recipes.forEach((e=>{t[e].locked=!1})),this.button.classList.replace("inactive","active"))}lock(){this.locked||(this.dependants.forEach((e=>{E[e].lock()})),this.locked=!0,this.buildings.forEach((e=>{o[e].locked=!0})),this.recipes.forEach((e=>{t[e].locked=!0})),this.button.classList.replace("active","inactive"))}toggleResearch(){this.locked?this.unlock():this.lock()}static initResearchesWindow(){const e=document.getElementById("researches_container");for(const t of Object.values(a)){const n=document.createElement("div"),i=document.createElement("h1"),s=document.createElement("hr"),o=document.createElement("div");n.classList.add("researches_lists_container"),i.textContent=t,o.classList.add("flex_row","flex_allow_wrap"),n.appendChild(i),n.appendChild(s),n.appendChild(o),e.appendChild(n),l.researches_level_containers.set(t,n),l.researches_lists.set(t,o)}}createResearchButton(){var e;const t=document.createElement("div");return t.textContent=this.name,t.classList.add("button",this.locked?"inactive":"active"),t.addEventListener("click",this.toggleResearch.bind(this)),null===(e=l.researches_lists.get(this.level))||void 0===e||e.appendChild(t),t}}l.researches_level_containers=new Map,l.researches_lists=new Map,l.initResearchesWindow();const d=new Map,E=Object.fromEntries(Object.values(c).filter((e=>"number"==typeof e)).map((e=>{var t;return null===(t=r[e].dependencies)||void 0===t||t.forEach((t=>{d.set(e,t)})),[e,new l(r[e])]})));var h;d.forEach(((e,t)=>{E[e].dependants.push(t)})),function(e){e.DEFAULT="default",e.SUCCESS="success",e.WARNING="warning",e.ERROR="error"}(h||(h={}));class u{constructor(e,t,n=h.DEFAULT,i=0,s=!0){this.heading=e,this.message=t,this.style=n,this.notification=this.createNotification(),this.button_container=this.createButtonContainer(),s&&this.createCloseButton(),u.container.appendChild(this.notification),i>0&&(this.timeout=window.setTimeout(this.closeNotification.bind(this),i))}createNotification(){const e=document.createElement("div");e.classList.add(this.style);const t=document.createElement("h1");t.textContent=this.heading,e.appendChild(t);const n=document.createElement("p");return n.innerHTML=this.message,e.appendChild(n),e}createButtonContainer(){const e=document.createElement("div");return e.classList.add("flex_row"),this.notification.appendChild(e),e}createCloseButton(){const e=document.createElement("div");e.textContent="Close",e.classList.add("button"),e.addEventListener("click",this.closeNotification.bind(this)),this.button_container.appendChild(e)}closeNotification(){this.notification.remove(),this.timeout&&window.clearTimeout(this.timeout)}}u.container=document.getElementById("notifs_container");class _ extends u{constructor(e,t,n=h.DEFAULT,i){super(e,t,n,0,!1),this.buttons=i}setupPromptButtons(e){this.buttons.forEach((t=>{const n=document.createElement("div");n.textContent=t.label,n.classList.add("button"),n.addEventListener("click",this.closeNotification.bind(this)),n.addEventListener("click",(()=>e(t.retval))),this.button_container.appendChild(n)}))}prompt(){return new Promise((e=>{this.setupPromptButtons(e)}))}}var R=function(e,t,n,i){return new(n||(n=Promise))((function(s,o){function c(e){try{r(i.next(e))}catch(e){o(e)}}function a(e){try{r(i.throw(e))}catch(e){o(e)}}function r(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,a)}r((i=i.apply(e,t||[])).next())}))};let m=!1,p=!1,A=!1;const L=document.getElementById("set_researches_btn"),f=document.getElementById("set_recipes_btn"),S=document.getElementById("researches_window"),w=document.getElementById("recipes_window");var v;function g(){S.classList.toggle("hidden"),L.classList.toggle("active"),A&&I(),p=!p}function I(){w.classList.toggle("hidden"),f.classList.toggle("active"),p&&g(),A=!A}function b(n){return R(this,void 0,void 0,(function*(){let i,s;i=n?function(){const e=new URLSearchParams(window.location.search);return{research:e.get("research"),recipes:e.get("recipes"),inputs:e.get("inputs"),outputs:e.get("outputs")}}():{research:window.localStorage.getItem("research"),recipes:window.localStorage.getItem("recipes"),inputs:window.localStorage.getItem("inputs"),outputs:window.localStorage.getItem("outputs")};try{s=function(e){var t,n,i,s;try{const o=JSON.parse(null!==(t=e.research)&&void 0!==t?t:"[]"),c=JSON.parse(null!==(n=e.recipes)&&void 0!==n?n:"[]"),a=JSON.parse(null!==(i=e.inputs)&&void 0!==i?i:"[]"),r=JSON.parse(null!==(s=e.outputs)&&void 0!==s?s:"[]");return[o,c,a,r].forEach((e=>{if(!Array.isArray(e))throw new Error("One of the parameters isn't an array.");e.forEach(((e,t,n)=>{if("number"!=typeof e&&(n[t]=Number(e),isNaN(n[t])))throw new Error("One of the arrays contains something other than a number.")}))})),{research:o,recipes:c,inputs:a,outputs:r}}catch(e){throw e}}(i)}catch(e){let t="Unknown Error",i="";if(e instanceof SyntaxError?(t=v.MALFORMED_JSON_HEADER,i=n?v.MALFORMED_JSON_MESSAGE_URL+v.ERROR_FIX_MESSAGE_URL:v.MALFORMED_JSON_MESSAGE_LOCALSTORAGE+v.ERROR_FIX_MESSAGE_LOCALSTORAGE):e instanceof Error&&(t=v.INVALID_DATA_HEADER,i=e.message+(n?v.ERROR_FIX_MESSAGE_URL:v.ERROR_FIX_MESSAGE_LOCALSTORAGE)),!(yield new _(t,i,h.ERROR,[{label:"Yes",retval:!0},{label:"No",retval:!1}]).prompt()))throw new u("Successfully Aborted","Initialization was successfully aborted.",void 0,void 0,!1),"";if(n){const e=new URL(window.location.href);e.search="",history.pushState(null,"",e.toString())}else window.localStorage.clear(),window.location.reload();return!1}return function(n){n.research.forEach((e=>{e in c?E[e].toggleResearch():new u("Unknown Research ID",`The research ID ${e} is unknown and could not be enabled.`,h.WARNING)})),n.recipes.forEach((n=>{n in e?t[n].active=!1:new u("Unknown Recipe ID",`The recipe ID ${n} is unknown and could not be disabled.`,h.WARNING)}))}(s),!0}))}!function(e){e.MALFORMED_JSON_HEADER="Malformed JSON",e.INVALID_DATA_HEADER="Invalid Data",e.MALFORMED_JSON_MESSAGE_URL="The JSON provided by the search parameters in the URL seems to be malformed.",e.MALFORMED_JSON_MESSAGE_LOCALSTORAGE="The JSON loaded from your browsers local storage seems to be malformed.",e.ERROR_FIX_MESSAGE_URL="<br><br>Do you want to continue anyways, loading your usual settings, losing the current calculation in the process?",e.ERROR_FIX_MESSAGE_LOCALSTORAGE="<br><br>Do you want clear it and try again? This means losing your selected research and recipes."}(v||(v={})),function(){R(this,void 0,void 0,(function*(){if(window.location.search)try{m=yield b(!0)}catch(e){return}if(!m)try{yield b(!1)}catch(e){return}[[L,"click",g],[f,"click",I]].forEach((([e,t,n])=>{e.addEventListener(t,n)})),L.click()}))}()})();