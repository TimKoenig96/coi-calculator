(()=>{"use strict";var t;t||(t={});const e={};var n;n||(n={});const o={};var i;!function(t){t[t.EXAMPLE_RESEARCH_1=1]="EXAMPLE_RESEARCH_1",t[t.EXAMPLE_RESEARCH_2=2]="EXAMPLE_RESEARCH_2",t[t.EXAMPLE_RESEARCH_3=3]="EXAMPLE_RESEARCH_3"}(i||(i={}));class r{constructor(t,e=[],n=[],o=[],i=[],r=!1){this.name=t,this.requirements=e,this.required_by=n,this.building_unlocks=o,this.recipe_unlocks=i,this.unlocked=r}isUnlocked(){return this.unlocked}unlock(){this.unlocked||(this.requirements.forEach((t=>{s[t].unlock()})),this.unlocked=!0,this.building_unlocks.forEach((t=>{e[t].unlocked=!0})),this.recipe_unlocks.forEach((t=>{o[t].unlocked=!0})))}lock(){this.unlocked&&(this.required_by.forEach((t=>{s[t].lock()})),this.unlocked=!1,this.building_unlocks.forEach((t=>{e[t].unlocked=!1})),this.recipe_unlocks.forEach((t=>{o[t].unlocked=!0})))}}const s={[i.EXAMPLE_RESEARCH_1]:new r("Example Research 1",[],[i.EXAMPLE_RESEARCH_3]),[i.EXAMPLE_RESEARCH_2]:new r("Example Research 2",[],[i.EXAMPLE_RESEARCH_3]),[i.EXAMPLE_RESEARCH_3]:new r("Example Research 3",[i.EXAMPLE_RESEARCH_1,i.EXAMPLE_RESEARCH_2])};var c;!function(t){t.DEFAULT="default",t.SUCCESS="success",t.WARNING="warning",t.ERROR="error"}(c||(c={}));class a{constructor(t,e,n=c.DEFAULT,o=0,i=!0){this.heading=t,this.message=e,this.style=n,this.notification=this.createNotification(),this.button_container=this.createButtonContainer(),i&&this.createCloseButton(),a.container.appendChild(this.notification),o>0&&(this.timeout=window.setTimeout(this.closeNotification.bind(this),o))}createNotification(){const t=document.createElement("div");t.classList.add(this.style);const e=document.createElement("h1");e.textContent=this.heading,t.appendChild(e);const n=document.createElement("p");return n.innerHTML=this.message,t.appendChild(n),t}createButtonContainer(){const t=document.createElement("div");return t.classList.add("flex_row"),this.notification.appendChild(t),t}createCloseButton(){const t=document.createElement("div");t.textContent="Close",t.classList.add("button"),t.addEventListener("click",this.closeNotification.bind(this)),this.button_container.appendChild(t)}closeNotification(){this.notification.remove(),this.timeout&&window.clearTimeout(this.timeout)}}a.container=document.getElementById("notifs_container");class u extends a{constructor(t,e,n=c.DEFAULT,o){super(t,e,n,0,!1),this.buttons=o}setupPromptButtons(t){this.buttons.forEach((e=>{const n=document.createElement("div");n.textContent=e.label,n.classList.add("button"),n.addEventListener("click",this.closeNotification.bind(this)),n.addEventListener("click",(()=>t(e.retval))),this.button_container.appendChild(n)}))}prompt(){return new Promise((t=>{this.setupPromptButtons(t)}))}}var l=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function s(t){try{a(o.next(t))}catch(t){r(t)}}function c(t){try{a(o.throw(t))}catch(t){r(t)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,c)}a((o=o.apply(t,e||[])).next())}))};let E=!1;var h;function d(t){return l(this,void 0,void 0,(function*(){let e,r;e=t?function(){const t=new URLSearchParams(window.location.search);return{research:t.get("research"),recipes:t.get("recipes"),inputs:t.get("inputs"),outputs:t.get("outputs")}}():{research:window.localStorage.getItem("research"),recipes:window.localStorage.getItem("recipes"),inputs:window.localStorage.getItem("inputs"),outputs:window.localStorage.getItem("outputs")};try{r=function(t){var e,n,o,i;try{const r=JSON.parse(null!==(e=t.research)&&void 0!==e?e:"[]"),s=JSON.parse(null!==(n=t.recipes)&&void 0!==n?n:"[]"),c=JSON.parse(null!==(o=t.inputs)&&void 0!==o?o:"[]"),a=JSON.parse(null!==(i=t.outputs)&&void 0!==i?i:"[]");return[r,s,c,a].forEach((t=>{if(!Array.isArray(t))throw new Error("One of the parameters isn't an array.");t.forEach(((t,e,n)=>{if("number"!=typeof t&&(n[e]=Number(t),isNaN(n[e])))throw new Error("One of the arrays contains something other than a number.")}))})),{research:r,recipes:s,inputs:c,outputs:a}}catch(t){throw t}}(e)}catch(e){let n="Unknown Error",o="";if(e instanceof SyntaxError?(n=h.MALFORMED_JSON_HEADER,o=t?h.MALFORMED_JSON_MESSAGE_URL+h.ERROR_FIX_MESSAGE_URL:h.MALFORMED_JSON_MESSAGE_LOCALSTORAGE+h.ERROR_FIX_MESSAGE_LOCALSTORAGE):e instanceof Error&&(n=h.INVALID_DATA_HEADER,o=e.message+(t?h.ERROR_FIX_MESSAGE_URL:h.ERROR_FIX_MESSAGE_LOCALSTORAGE)),!(yield new u(n,o,c.ERROR,[{label:"Yes",retval:!0},{label:"No",retval:!1}]).prompt()))throw new a("Successfully Aborted","Initialization was successfully aborted.",void 0,void 0,!1),"";if(t){const t=new URL(window.location.href);t.search="",history.pushState(null,"",t.toString())}else window.localStorage.clear(),window.location.reload();return!1}return function(t){t.research.forEach((t=>{t in i?s[t].unlock():new a("Unknown Research ID",`The research ID ${t} is unknown and could not be enabled.`,c.WARNING)})),t.recipes.forEach((t=>{t in n?o[t].active=!1:new a("Unknown Recipe ID",`The recipe ID ${t} is unknown and could not be disabled.`,c.WARNING)}))}(r),!0}))}!function(t){t.MALFORMED_JSON_HEADER="Malformed JSON",t.INVALID_DATA_HEADER="Invalid Data",t.MALFORMED_JSON_MESSAGE_URL="The JSON provided by the search parameters in the URL seems to be malformed.",t.MALFORMED_JSON_MESSAGE_LOCALSTORAGE="The JSON loaded from your browsers local storage seems to be malformed.",t.ERROR_FIX_MESSAGE_URL="<br><br>Do you want to continue anyways, loading your usual settings, losing the current calculation in the process?",t.ERROR_FIX_MESSAGE_LOCALSTORAGE="<br><br>Do you want clear it and try again? This means losing your selected research and recipes."}(h||(h={})),function(){l(this,void 0,void 0,(function*(){if(window.location.search)try{E=yield d(!0)}catch(t){return}if(!E)try{yield d(!1)}catch(t){return}}))}()})();