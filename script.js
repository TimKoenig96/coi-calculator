(()=>{"use strict";var e;e||(e={});const t={};var n;n||(n={});const i={};var o,s;!function(e){e[e.EXAMPLE_RESEARCH_1=1]="EXAMPLE_RESEARCH_1",e[e.EXAMPLE_RESEARCH_2=2]="EXAMPLE_RESEARCH_2",e[e.EXAMPLE_RESEARCH_3=3]="EXAMPLE_RESEARCH_3"}(o||(o={})),function(e){e.RESEARCH_1="Research I",e.RESEARCH_2="Research II",e.RESEARCH_3="Research III",e.RESEARCH_4="Research IV",e.RESEARCH_5="Research V"}(s||(s={}));const c={[o.EXAMPLE_RESEARCH_1]:{name:"Example Research 1",level:s.RESEARCH_1},[o.EXAMPLE_RESEARCH_2]:{name:"Example Research 2",level:s.RESEARCH_2},[o.EXAMPLE_RESEARCH_3]:{name:"Example Research 3",level:s.RESEARCH_3}},a=new Map;class r{constructor({name:e,level:t,dependencies:n=[],dependants:i=[],buildings:o=[],recipes:s=[],locked:c=!0}){this.name=e,this.level=t,this.dependencies=n,this.dependants=i,this.buildings=o,this.recipes=s,this.locked=c}isLocked(){return this.locked}unlock(){this.locked&&(this.dependencies.forEach((e=>{var t;null===(t=a.get(e))||void 0===t||t.unlock()})),this.locked=!1,this.buildings.forEach((e=>{t[e].locked=!1})),this.recipes.forEach((e=>{i[e].locked=!1})))}lock(){this.locked||(this.dependants.forEach((e=>{var t;null===(t=a.get(e))||void 0===t||t.lock()})),this.locked=!0,this.buildings.forEach((e=>{t[e].locked=!0})),this.recipes.forEach((e=>{i[e].locked=!0})))}static instantiateAll(){for(const[e,t]of Object.entries(c));}}var l;!function(e){e.DEFAULT="default",e.SUCCESS="success",e.WARNING="warning",e.ERROR="error"}(l||(l={}));class d{constructor(e,t,n=l.DEFAULT,i=0,o=!0){this.heading=e,this.message=t,this.style=n,this.notification=this.createNotification(),this.button_container=this.createButtonContainer(),o&&this.createCloseButton(),d.container.appendChild(this.notification),i>0&&(this.timeout=window.setTimeout(this.closeNotification.bind(this),i))}createNotification(){const e=document.createElement("div");e.classList.add(this.style);const t=document.createElement("h1");t.textContent=this.heading,e.appendChild(t);const n=document.createElement("p");return n.innerHTML=this.message,e.appendChild(n),e}createButtonContainer(){const e=document.createElement("div");return e.classList.add("flex_row"),this.notification.appendChild(e),e}createCloseButton(){const e=document.createElement("div");e.textContent="Close",e.classList.add("button"),e.addEventListener("click",this.closeNotification.bind(this)),this.button_container.appendChild(e)}closeNotification(){this.notification.remove(),this.timeout&&window.clearTimeout(this.timeout)}}d.container=document.getElementById("notifs_container");class E extends d{constructor(e,t,n=l.DEFAULT,i){super(e,t,n,0,!1),this.buttons=i}setupPromptButtons(e){this.buttons.forEach((t=>{const n=document.createElement("div");n.textContent=t.label,n.classList.add("button"),n.addEventListener("click",this.closeNotification.bind(this)),n.addEventListener("click",(()=>e(t.retval))),this.button_container.appendChild(n)}))}prompt(){return new Promise((e=>{this.setupPromptButtons(e)}))}}var u=function(e,t,n,i){return new(n||(n=Promise))((function(o,s){function c(e){try{r(i.next(e))}catch(e){s(e)}}function a(e){try{r(i.throw(e))}catch(e){s(e)}}function r(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,a)}r((i=i.apply(e,t||[])).next())}))};let h=!1,R=!1,p=!1;const _=document.getElementById("set_researches_btn"),m=document.getElementById("set_recipes_btn"),f=document.getElementById("researches_window"),A=document.getElementById("researches_container"),S=document.getElementById("recipes_window"),w=new Map,v=new Map;var L;function g(e){}function C(){f.classList.toggle("hidden"),_.classList.toggle("active"),p&&O(),R=!R}function O(){S.classList.toggle("hidden"),m.classList.toggle("active"),R&&C(),p=!p}function b(e){return u(this,void 0,void 0,(function*(){let t,s;t=e?function(){const e=new URLSearchParams(window.location.search);return{research:e.get("research"),recipes:e.get("recipes"),inputs:e.get("inputs"),outputs:e.get("outputs")}}():{research:window.localStorage.getItem("research"),recipes:window.localStorage.getItem("recipes"),inputs:window.localStorage.getItem("inputs"),outputs:window.localStorage.getItem("outputs")};try{s=function(e){var t,n,i,o;try{const s=JSON.parse(null!==(t=e.research)&&void 0!==t?t:"[]"),c=JSON.parse(null!==(n=e.recipes)&&void 0!==n?n:"[]"),a=JSON.parse(null!==(i=e.inputs)&&void 0!==i?i:"[]"),r=JSON.parse(null!==(o=e.outputs)&&void 0!==o?o:"[]");return[s,c,a,r].forEach((e=>{if(!Array.isArray(e))throw new Error("One of the parameters isn't an array.");e.forEach(((e,t,n)=>{if("number"!=typeof e&&(n[t]=Number(e),isNaN(n[t])))throw new Error("One of the arrays contains something other than a number.")}))})),{research:s,recipes:c,inputs:a,outputs:r}}catch(e){throw e}}(t)}catch(t){let n="Unknown Error",i="";if(t instanceof SyntaxError?(n=L.MALFORMED_JSON_HEADER,i=e?L.MALFORMED_JSON_MESSAGE_URL+L.ERROR_FIX_MESSAGE_URL:L.MALFORMED_JSON_MESSAGE_LOCALSTORAGE+L.ERROR_FIX_MESSAGE_LOCALSTORAGE):t instanceof Error&&(n=L.INVALID_DATA_HEADER,i=t.message+(e?L.ERROR_FIX_MESSAGE_URL:L.ERROR_FIX_MESSAGE_LOCALSTORAGE)),!(yield new E(n,i,l.ERROR,[{label:"Yes",retval:!0},{label:"No",retval:!1}]).prompt()))throw new d("Successfully Aborted","Initialization was successfully aborted.",void 0,void 0,!1),"";if(e){const e=new URL(window.location.href);e.search="",history.pushState(null,"",e.toString())}else window.localStorage.clear(),window.location.reload();return!1}return function(e){e.research.forEach((e=>{e in o||new d("Unknown Research ID",`The research ID ${e} is unknown and could not be enabled.`,l.WARNING)})),e.recipes.forEach((e=>{e in n?i[e].active=!1:new d("Unknown Recipe ID",`The recipe ID ${e} is unknown and could not be disabled.`,l.WARNING)}))}(s),!0}))}!function(e){e.MALFORMED_JSON_HEADER="Malformed JSON",e.INVALID_DATA_HEADER="Invalid Data",e.MALFORMED_JSON_MESSAGE_URL="The JSON provided by the search parameters in the URL seems to be malformed.",e.MALFORMED_JSON_MESSAGE_LOCALSTORAGE="The JSON loaded from your browsers local storage seems to be malformed.",e.ERROR_FIX_MESSAGE_URL="<br><br>Do you want to continue anyways, loading your usual settings, losing the current calculation in the process?",e.ERROR_FIX_MESSAGE_LOCALSTORAGE="<br><br>Do you want clear it and try again? This means losing your selected research and recipes."}(L||(L={})),function(){u(this,void 0,void 0,(function*(){if(r.instantiateAll(),function(){var e;for(const e of Object.values(s)){const t=document.createElement("div"),n=document.createElement("h1"),i=document.createElement("hr"),o=document.createElement("div");t.classList.add("researches_lists_container"),n.textContent=e,o.classList.add("flex_row","flex_allow_wrap"),t.appendChild(n),t.appendChild(i),t.appendChild(o),A.appendChild(t),w.set(e,t),v.set(e,o)}for(const[t,n]of Object.entries(a)){const i=document.createElement("div");i.textContent=n.name,i.classList.add("button",n.isUnlocked()?"active":"inactive"),i.dataset.toggles=t,i.addEventListener("click",g),null===(e=v.get(n.lab_level))||void 0===e||e.appendChild(i)}}(),window.location.search)try{h=yield b(!0)}catch(e){return}if(!h)try{yield b(!1)}catch(e){return}[[_,"click",C],[m,"click",O]].forEach((([e,t,n])=>{e.addEventListener(t,n)}))}))}()})();